{{ define "main" }}
<article class="pa3 pa4-ns nested-copy-line-height">
  <div class="mw8 center">
    <input id="search-input" class="input-reset ba b--black-20 br2 pa3 mb4 db w-100 f4" type="search" placeholder="Buscar recetas...">
    <p id="search-empty" class="gray f5" style="display:none">No se encontraron recetas.</p>
    <section id="search-results"></section>
  </div>
</article>
<script type="module">
  const input = document.getElementById('search-input');
  const resultsEl = document.getElementById('search-results');
  const emptyEl = document.getElementById('search-empty');

  const pagefind = await import('/pagefind/pagefind.js');
  await pagefind.init();

  let debounce;
  input.addEventListener('input', () => {
    clearTimeout(debounce);
    debounce = setTimeout(async () => {
      resultsEl.innerHTML = '';
      emptyEl.style.display = 'none';

      const query = input.value.trim();
      if (!query) return;

      const search = await pagefind.search(query);
      if (search.results.length === 0) {
        emptyEl.style.display = '';
        return;
      }

      for (const result of search.results) {
        const data = await result.data();

        const card = document.createElement('div');
        card.className = 'w-100 mb4 relative bg-white';

        const link = document.createElement('a');
        link.href = data.url;
        link.className = 'link black dim';

        const outer = document.createElement('div');
        outer.className = 'relative w-100 bg-white nested-copy-line-height';

        const inner = document.createElement('div');
        inner.className = 'bg-white pa4 gray overflow-hidden';

        if (data.meta.category) {
          const cat = document.createElement('span');
          cat.className = 'f6 db';
          cat.textContent = data.meta.category;
          inner.appendChild(cat);
        }

        const title = document.createElement('h1');
        title.className = 'f3 near-black';
        title.textContent = data.meta.title;
        inner.appendChild(title);

        const excerpt = document.createElement('div');
        excerpt.className = 'nested-links f5 lh-copy nested-copy-line-height';
        excerpt.innerHTML = data.excerpt;
        inner.appendChild(excerpt);

        outer.appendChild(inner);
        link.appendChild(outer);
        card.appendChild(link);
        resultsEl.appendChild(card);
      }
    }, 300);
  });
</script>
{{ end }}
